<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Order Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container mt-4">
    <h2>Order Management</h2>
    <table class="table table-hover table-striped table-bordered">
        <thead class="table-dark">
        <tr>
            <th>Order ID</th>
            <th>Customer Name</th>
            <th>Total</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="orderTable"></tbody>
    </table>
</div>

<script>
    const orderTable = document.getElementById('orderTable');

    async function fetchOrders() {
        try {
            const response = await axios.get('/api/orders');
            renderOrderTable(response.data);
        } catch (error) {
            console.error('Error fetching orders:', error);
        }
    }

    function renderOrderTable(orders) {
        orderTable.innerHTML = '';
        orders.forEach(order => {
            orderTable.innerHTML += `
                <tr>
                    <td>${order.id}</td>
                    <td>${order.customer.name}</td>
                    <td>${order.total}</td>
                    <td>${order.status}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editOrder(${order.id})">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder(${order.id})">Delete</button>
                    </td>
                </tr>
            `;
        });
    }

    async function editOrder(id) {
        alert(`Feature to edit order ${id} coming soon!`);
    }

    async function deleteOrder(id) {
        if (confirm('Are you sure you want to delete this order?')) {
            try {
                await axios.delete(`/api/orders/${id}`);
                fetchOrders();
            } catch (error) {
                console.error('Error deleting order:', error);
            }
        }
    }

    window.onload = fetchOrders;
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
